<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calculating the score distribution given ability • dexter</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><link href="../../extra.css" rel="stylesheet">
<meta property="og:title" content="Calculating the score distribution given ability">
<meta property="og:description" content="dexter">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">dexter</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.4.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../articles/dexter.html">Get started</a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/DIF_vignette.html">Exploring Differential Items Functioning with Dexter</a>
    </li>
    <li>
      <a href="../../articles/Equating.html">Equating a Pass-Fail Score</a>
    </li>
    <li>
      <a href="../../articles/Plausible_Values.html">Plausible Values in Dexter</a>
    </li>
    <li>
      <a href="../../articles/profile-plots.html">How Members of Different Groups Obtain the Same Test Score: Profile Plots in Dexter</a>
    </li>
    <li>
      <a href="../../articles/Test_Individual_differences.html">One theta to rule them all: Test Individual Differences</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../articles/blog/index.html">Blog</a>
</li>
<li>
  <a href="../../articles/blog/about.html">About</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/dexter-psychometrics/dexter" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Calculating the score distribution given
ability</h1>
                        <h4 data-toc-skip class="author">Timo
Bechger</h4>
            
            <h4 data-toc-skip class="date">2020-05-15</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/dexter-psychometrics/dexter/blob/HEAD/vignettes/blog/2020-05-15-calculating-the-score-distribution-giving-ability.Rmd" class="external-link"><code>vignettes/blog/2020-05-15-calculating-the-score-distribution-giving-ability.Rmd</code></a></small>
      <div class="hidden name"><code>2020-05-15-calculating-the-score-distribution-giving-ability.Rmd</code></div>

    </div>

    
    
<p><b>[A muggle preface by Ivailo]</b> <i>As every fantasy lover knows,
IRT people belong to two towers, or is it schools of magic. The little
wizards and witches of one school learn to condition on their sufficient
statistics before they can even fly or play quidditch, while at the
other school they will integrate out anything thrown at them.</i></p>
<p>The two approaches have their subtle differences. To predict the
score distribution conditional on ability, wizards at the first school
apply the same powerful curse, elementary symmetric functions, that they
use for all kinds of magic – from catching dragons over estimating
parameters, up to item-total and item-rest regressions, to mention but a
few. At the second school, computing the score distribution used to be a
frustrating task until <span class="citation">Lord and Wingersky
(1984)</span> came up with a seemingly unrelated jinx that did the
trick.</p>
<p>In what follows, Timo explains how the two kinds of magic relate to
each other.</p>
<p>Consider the Rasch model. Let <span class="math inline">\(X_{i}\)</span> denote the binary-coded response to
item <span class="math inline">\(i\)</span> and assume that: <span class="math display">\[
p(\mathbf{x}|t,\mathbf{b}) =\prod_i p(x_{i}|t,b_i) =\frac{t^{x_+}
\prod_i b^{x_{i}}_i}{\prod_i (1 + t b_i)}
\]</span> where <span class="math inline">\(t&gt;0\)</span> is person
ability, <span class="math inline">\(b_i\)</span> the difficulty of item
<span class="math inline">\(i\)</span>, and <span class="math inline">\(x_+\)</span> the number of correct answers.
Conditional on the person’s ability and the item difficulties, the test
score distribution is: <span class="math display">\[
P(X_+=s|t, \mathbf{b}) = \sum_{\mathbf{x} : x_+ = s}
p(\mathbf{x}|t,\mathbf{b}) =\frac{t^s \gamma_s(\boldsymbol{b})}{\prod_i
(1+t b_i)},
\]</span> where <span class="math inline">\(\gamma_s(\boldsymbol{b}) =
\sum_{\mathbf{x} : x_+ = s} \prod_i b_i^{x_i}\)</span> is the
<em>elementary symmetric function (esf)</em> of order <span class="math inline">\(s\)</span> of the item parameters <span class="math inline">\(\mathbf{b}=(b_1,b_2,\dots, b_m)\)</span>.</p>
<p>Thus, the esf arise naturally when one works with Rasch models. They
appear when we expand a linear factorization of a monic polynomial. More
specifically, since <span class="math inline">\(\sum_s
P(X_+=s|\theta)=1\)</span>, we find the identity:<br><span class="math display">\[
\prod^m_{i=1} (1+tb_i)
=\sum^m_{s=0} \gamma_s(\boldsymbol{b}) t^s
\]</span> which is a generalization of Newton’s binomial theorem where
<span class="math inline">\(\mathbf{b} = \mathbf{1}\)</span> and <span class="math inline">\(\gamma_s(\mathbf{1}) = {m \choose s}\)</span>.</p>
<p>The notation can be adapted to also handle items with more than two
score categories. Let <span class="math inline">\(y_{ij}\)</span> denote
the dummy-coded response to item <span class="math inline">\(i\)</span>;
that is, <span class="math inline">\(y_{ij}=1\)</span> category <span class="math inline">\(j \in \{0,\dots, m_i\}\)</span> of item <span class="math inline">\(i\)</span> is picked and zero otherwise. Let <span class="math inline">\(a_{ij}\)</span> denote the number of points earned
for a response in category <span class="math inline">\(j\)</span> such
that <span class="math inline">\(a_{i0}=0\)</span>. The IRT model
becomes <span class="math display">\[
p(\mathbf{y}|t,\mathbf{b}) = \prod_i \frac{\prod_j \left(
t^{a_{ij}}b_{ij}\right)^{y_{ij}}}{\sum_j t^{a_{ij}}b_{ij}}
\]</span></p>
<p>This is a nominal response model with fixed integer item-category
scores. We use the letter <span class="math inline">\(b\)</span> for the
item parameters but note that we have included a dummy parameter <span class="math inline">\(b_{i0}=1\)</span> for the lowest category. For a
dichotomous item, <span class="math inline">\(m_i=1\)</span>, so that
<span class="math inline">\(j\in\{0,1\}\)</span>, <span class="math inline">\(a_{i0}=0\)</span>, <span class="math inline">\(a_{i1}=1\)</span>, and <span class="math inline">\(b_{i1}=b_i\)</span>.</p>
<p>Using this notation, the test score distribution is: <span class="math display">\[
P(Y_{++}=s|t, \mathbf{b}) = \frac{t^{y_{++}}
\gamma_s(\boldsymbol{b})}{\prod_i \left(\sum_j t^{a_{ij}}b_{ij}\right)},
\]</span> where <span class="math inline">\(y_{++}=\sum_i \sum_j a_{ij}
y_{ij} = x_+\)</span>. and esf are defined as: <span class="math display">\[
\gamma_s(\mathbf{b}) = \sum_{\mathbf{y}:y_{++}=s} \prod_i \prod_j
b^{y_{ij}}_{ij}
\]</span> It follows that: <span class="math display">\[
\prod^m_{i=1} \left(1+\sum^{m_i}_{j=1} t^{a_{ij}}b_{ij}\right) =
\sum^{M}_{s=0} t^{s} \gamma_s(\boldsymbol{b})
\]</span> where <span class="math inline">\(s\)</span> now runs over
values of <span class="math inline">\(y_{++}\)</span>; that is, from
zero to the highest test score <span class="math inline">\(M=\sum_i
a_{im_i}\)</span>.</p>
<p>To illustrate, consider <span class="math inline">\(m=2\)</span>
items with three categores each; that is, <span class="math inline">\(m_i=2\)</span>, and <span class="math inline">\(a_{i1}=1\)</span>. Writing <span class="math inline">\(\gamma_s\)</span> as short-hand for <span class="math inline">\(\gamma_s(\mathbf{b})\)</span> the above identity
says: <span class="math display">\[
\left(1+t^{a_{11}}b_{11} + t^{a_{21}}b_{21}\right)
\left(1+t^{a_{11}}b_{11} + t^{a_{21}}b_{21}\right)=
\gamma_0 t^0 + \gamma_1 t^1 + \gamma_2 t^2 + t^3 \gamma_3 + \gamma_4 t^2
\]</span> where <span class="math display">\[\begin{align*}
\gamma_0 &amp;=1 \text{(by definition)}\\
\gamma_1 &amp;=b_{11}+b_{21}\\
\gamma_2 &amp;=b_{22}+b_{11}b_{21}+b_{12}\\
\gamma_3 &amp;=b_{11}b_{22}+b_{12}b_{21} \\
\gamma_4 &amp;=b_{12}b_{21}
\end{align*}\]</span> Looking at the subscripts, an easy trick is: <span class="math inline">\(\gamma_s\)</span> is the sum of the products of
item parameters over all possible ways to obtain a score <span class="math inline">\(s\)</span>. For example, a score of 2 can be
obtained by a score of 2 on item 2, a score of 1 on both items or a
score of 2 on item 1. Note that, for any score that is impossible, the
corresponding esf is set to zero.</p>
<p>The esf are sums of products and calculating these is not trivial as
rounding errors tend to accumulate. Fortunately, the esf satisfy the
following recursive relation: <span class="math display">\[
\gamma_s(\mathbf{b})
=
\sum^{m_i}_{j=0} \gamma_{s-a_{ij}}(\mathbf{b}^{(i)}) b_{ij},
\]</span> where <span class="math inline">\(\mathbf{b}^{(i)}\)</span>
denotes the item parameters excluding the parameters that belong to item
<span class="math inline">\(i\)</span>. This recursion is the basis for
a numerically stable algorithm known as <em>the sum (or
summation)-algorithm</em>. Proposed by <span class="citation">Andersen
(1972)</span>, this algorithm is implemented in dexter’s
<strong>elsym</strong> function.</p>
<p>We illustrate the sum-algorithm with three Rasch items ordered in an
arbitrary way. We begin the recursion with the first item: <span class="math inline">\(\gamma^{[1]}_0 = b_{10} = 1\)</span> and <span class="math inline">\(\gamma^{[1]}_1 = b_{11}\)</span>, where the
superscript indicates the number of items. Then, we add the second item:
<span class="math display">\[\begin{align*}
\gamma^{[2]}_0 &amp;= \gamma^{[1]}_{0}b_{20} = b_{10}b_{20} = 1\\
\gamma^{[2]}_1 &amp;= \gamma^{[1]}_{1}b_{20} + \gamma^{[1]}_{0}b_{21} =
b_{11}b_{20} + b_{21}b_{10}=b_{11}+b_{21}\\
\gamma^{[2]}_2 &amp;=  \gamma^{[1]}_{1}b_{21} = b_{11}b_{21}
\end{align*}\]</span> Finally, we add the third item: <span class="math display">\[\begin{align*}
\gamma^{[3]}_0 &amp;= \gamma^{[2]}_{0}b_{30} = b_{10}b_{20}b_{30} =  1\\
\gamma^{[3]}_1 &amp;= \gamma^{[2]}_{1}b_{30} + \gamma^{[2]}_{0}b_{31} =
b_{11}b_{20}b_{30} + b_{21}b_{10}b_{30} +b_{10}b_{20}b_{31} =
b_{11}+b_{21}+b_{31}\\
\gamma^{[3]}_2 &amp;= \gamma^{[2]}_{2}b_{30} + \gamma^{[2]}_{1}b_{31} =
b_{11}b_{21}b_{30}+b_{11}b_{20}b_{31} + b_{21}b_{10}b_{31}
=b_{11}b_{21} + b_{11}b_{31} + b_{21}b_{31}\\
\gamma^{[3]}_3 &amp;= \gamma^{[2]}_{2}b_{31}  = b_{11}b_{21}b_{31}
\end{align*}\]</span></p>
<p>Now consider two ways to calculate the conditional test score
distribution. First, using the identity in the previous section, we can
write: <span class="math display">\[
p(X_+=s|t) = p(Y_{++}=s|t, \mathbf{b}) = \frac{t^{y_{++}}
\gamma_s(\boldsymbol{b})}{\sum^M_{s=0} t^{s} \gamma_s(\mathbf{b})}
\]</span> This is the expression used by the <strong>p_score</strong>
function in dexter.</p>
<p>Second, we can also write: <span class="math display">\[
P(Y_{++}=s|t, \mathbf{b}) = \sum_{\mathbf{y}:y_+ = s} \prod_i \prod_j
\pi_{ij}^{y_{ij}} = \gamma_s(\boldsymbol{\pi})
\]</span> where <span class="math inline">\(\pi_{ij}\)</span> is
short-hand for <span class="math inline">\(p(Y_{ij}=1|t) =
p(X_i=j|t)\)</span>. Written in this way, the test score distribution is
an esf, albeit with argument <span class="math inline">\(\boldsymbol{\pi}\)</span>. The following R
function uses this observation to calculate the score distribution:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">LW</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">Pi</span>, <span class="va">a</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">first</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">a</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="va">last</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">first</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">-</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu">dexter</span><span class="fu">:::</span><span class="fu">elsym</span><span class="op">(</span><span class="va">Pi</span>,<span class="va">a</span>,<span class="va">first</span>,<span class="va">last</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The <strong>elsym</strong> function is internal to
<strong>dexter</strong>, hence the three colons. This function actually
implements the Lord-Wingersky algorithm, extended to polytomous items.
Compared to the first solution, it has the advantage that it works for
any valid <span class="math inline">\(\boldsymbol{\pi}=(\pi_{10},\pi_{11},\dots,
\pi_{m1})\)</span> and <span class="math inline">\(\mathbf{a}\)</span>
and could be used with any IRT model, not just the NRM implemented in
<strong>dexter</strong>.</p>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-andersen1972numerical" class="csl-entry">
Andersen, Erling B. 1972. <span>“The Numerical Solution of a Set of
Conditional Estimation Equations.”</span> <em>Journal of the Royal
Statistical Society: Series B (Methodological)</em> 34 (1): 42–54.
</div>
<div id="ref-lord1984comparison" class="csl-entry">
Lord, Frederic M, and Marilyn S Wingersky. 1984. <span>“Comparison of
IRT True-Score and Equipercentile Observed-Score Equatings.”</span>
<em>Applied Psychological Measurement</em> 8 (4): 453–61.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Gunter Maris, Timo Bechger, Jesse Koops, Ivailo Partchev.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
