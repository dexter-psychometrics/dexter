<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Jesse Koops" />

<meta name="date" content="2018-05-17" />

<title>Data management in dexter</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Data management in dexter</h1>
<h4 class="author"><em>Jesse Koops</em></h4>
<h4 class="date"><em>2018-05-17</em></h4>



<style>
img{ border:none;}
</style>
<p><strong>Dexter</strong> is intended as a fairly comprehensive system for managing and analyzing data from administrations of educational and psychological tests. The more advanced psychometric routines are buttressed by a solid data base management system and various functions allowing users to examine items and tests, detect and correct possible issues.</p>
<p>The data base that works under the hood is created automatically as data is imported into dexter. It remains virtually invisible to the users unless they are interested in it, in which case they can access it via dbplyr, RSQlite, or directly in various SQL tools. Generally, dexter scales well with respect to both the size of the problem and the degree of complexity and flexibility desired.</p>
<p>We begin with a brief review of how to start a dexter project and add data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)
<span class="kw">library</span>(dexter)

db =<span class="st"> </span><span class="kw">start_new_project</span>(verbAggrRules, <span class="st">&quot;verbAggression.db&quot;</span>, 
                       <span class="dt">covariates =</span> <span class="kw">list</span>(<span class="dt">gender=</span><span class="st">&quot;&lt;unknown&gt;&quot;</span>))</code></pre></div>
<p>The new project is actually a SQLite data base, which is created, initialized, and saved to the file, “verbAggression.db”. In this example, we add Gender as a person covariate with a default value of <code>&quot;&lt;unknown&gt;&quot;</code>.</p>
<p>The data set, <code>verbAggrData</code>, contains only one booklet, which we add to the project with:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">add_booklet</span>(db, <span class="dt">x=</span>verbAggrData, <span class="dt">booklet_id=</span><span class="st">&quot;agg&quot;</span>)</code></pre></div>
<pre><code>## no column `person_id` provided, automatically generating unqique person id's</code></pre>
<pre><code>## $items
##  [1] &quot;S1DoCurse&quot;   &quot;S1DoScold&quot;   &quot;S1DoShout&quot;   &quot;S1WantCurse&quot; &quot;S1WantScold&quot;
##  [6] &quot;S1WantShout&quot; &quot;S2DoCurse&quot;   &quot;S2DoScold&quot;   &quot;S2DoShout&quot;   &quot;S2WantCurse&quot;
## [11] &quot;S2WantScold&quot; &quot;S2WantShout&quot; &quot;S3DoCurse&quot;   &quot;S3DoScold&quot;   &quot;S3DoShout&quot;  
## [16] &quot;S3WantCurse&quot; &quot;S3WantScold&quot; &quot;S3WantShout&quot; &quot;S4DoCurse&quot;   &quot;S4DoScold&quot;  
## [21] &quot;S4DoShout&quot;   &quot;S4WantCurse&quot; &quot;S4WantScold&quot; &quot;S4WantShout&quot;
## 
## $person_properties
## [1] &quot;gender&quot;
## 
## $columns_ignored
## character(0)</code></pre>
<p>Had we not declared <code>gender</code> as a person covariate, the column would have been ignored, as it is not among the test items declared in <code>rules</code>. Dexter will work happily with data that does not include any person identification, in which case it will automatically create a <code>person_id</code> variable. However, there is an advantage to have your own <code>person_id</code> column in the data frames you enter. Dexter will treat this column as a key, which prevents you from accidentally entering the same data again by running <code>add_booklet(db, verbAggrData, &quot;agg&quot;)</code> a second time.</p>
<p>We can also add item properties. This data set comes from an experimental design with three factors, which can be added to the data base with:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">add_item_properties</span>(db, verbAggrProperties)</code></pre></div>
<pre><code>## 4 item properties for 24 items added or updated</code></pre>
<div id="a-note-about-names" class="section level3">
<h3>A note about names</h3>
<p>Due to the fact that we use an SQL database as a backend, the names of all item properties and person covariates must be valid SQL column names. This means that the name has to start with a letter and may contain only letters, numbers and underscores. Specifically, the dot {.} that is often used in variable names in R, cannot be used in a column name. Names that are not valid SQL column names will be silently converted. All names will also be converted to lowercase.</p>
<p>Of course this only applies to column names, values have no such restrictions.</p>
</div>
<div id="working-without-a-database" class="section level3">
<h3>Working without a database</h3>
<p>Many functions in dexter accept an argument <code>dataSrc</code>. A <code>dataSrc</code> can be either a dexter project database or a data.frame or a tibble, in long format, containing at least the columns <code>person_id</code>, <code>item_id</code>, <code>item_score</code> and, for a limited number of functions, <code>response</code>. See the help files for details.</p>
</div>
<div id="tidy-data" class="section level2">
<h2>Tidy data</h2>
<p>All data in dexter is stored and treated as normalized data, which is often called tidy data in the R world. As a result dexter ties in nicely with the Tidyverse packages and it is easy to extract tidy data from dexter and use it in ggplot or for your own summaries and statistics. As an example we look at the distribution of responses for the items in the verbal aggression dataset.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">get_responses</span>(db, <span class="dt">columns =</span> <span class="kw">c</span>(<span class="st">'item_id'</span>,<span class="st">'response'</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(item_id, response) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">count =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)</code></pre></div>
<pre><code>## # A tibble: 72 x 3
## # Groups:   item_id [24]
##    item_id     response count
##    &lt;chr&gt;       &lt;chr&gt;    &lt;int&gt;
##  1 S1DoCurse   0           91
##  2 S1DoCurse   1          108
##  3 S1DoCurse   2          117
##  4 S1DoScold   0          136
##  5 S1DoScold   1           97
##  6 S1DoScold   2           83
##  7 S1DoShout   0          208
##  8 S1DoShout   1           68
##  9 S1DoShout   2           40
## 10 S1WantCurse 0           91
## # ... with 62 more rows</code></pre>
<p>It is also easy enough to make some plots based on one of the item properties (situation in this instance). For the verbal aggression dataset this makes sense since identical items were administered for all situations, which makes the scores for each situation directly comparable.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">scores =<span class="st"> </span><span class="kw">get_responses</span>(db, <span class="dt">columns =</span> <span class="kw">c</span>(<span class="st">'person_id'</span>,<span class="st">'item_score'</span>,<span class="st">'situation'</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(person_id, situation) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">situation_score =</span> <span class="kw">sum</span>(item_score))  

<span class="kw">par</span>(<span class="dt">bty=</span><span class="st">'n'</span>, <span class="dt">fg=</span><span class="st">'white'</span>)

<span class="kw">boxplot</span>(situation_score <span class="op">~</span><span class="st"> </span>situation, scores, <span class="dt">border=</span><span class="st">'black'</span>)</code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
<div id="using-predicate-expressions" class="section level2">
<h2>Using predicate expressions</h2>
<p>Dexter keeps all scoring rules separately from response data, and applies them just before analysis. Together with the powerful techniques for quality analysis, from classical test statistics over distractor plots to the interaction model, this should allow users to detect and correct any items that have a technical flaw, such as a wrong key, which can be corrected with the function <code>touch_rules()</code>.</p>
<p>Nevertheless, there are occasions when an item, a booklet or a person must be omitted from analysis. Dexter implements a general system for subsetting data that offers an immensely wider range of possibilities – and some risks!</p>
<p>Many functions accept an optional argument <code>predicate</code>, which is an expression to subset data on. In this expression you can use item_properties, person covariates and several other variables to filter your data. To see which predicate variables are available in your project, use the function <code>get_variables</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">get_variables</span>(db)</code></pre></div>
<pre><code>##             name      type
## 1       behavior character
## 2          blame character
## 3     booklet_id character
## 4         gender character
## 5        item_id character
## 6  item_position   integer
## 7     item_score   integer
## 8           mode character
## 9      person_id character
## 10      response character
## 11     situation character</code></pre>
<p>As an example, suppose we know of a printing error in the third item in booklet “pretest” so we want to turn it off locally, and we also want to estimate the parameters solely for women. We can pass to <code>fit_enorm</code> the following predicate expression:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">par =<span class="st"> </span><span class="kw">fit_enorm</span>(db, gender<span class="op">==</span><span class="st">'female'</span> <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span>(booklet_id <span class="op">==</span><span class="st"> 'pretest'</span> <span class="op">&amp;</span><span class="st"> </span>item_position <span class="op">==</span><span class="st"> </span><span class="dv">3</span>))</code></pre></div>
<p>You can also use local variables in your expression, therefore the statement below is equivalent to the previous one:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bkl =<span class="st"> 'pretest'</span>
par =<span class="st"> </span><span class="kw">fit_enorm</span>(db, gender<span class="op">==</span><span class="st">'female'</span> <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span>(booklet_id <span class="op">==</span><span class="st"> </span>bkl <span class="op">&amp;</span><span class="st"> </span>item_position <span class="op">==</span><span class="st"> </span><span class="dv">3</span>))</code></pre></div>
<p>However, if you have want to use local variables that conflict with the variable names in your dexter project, it is best to resolve the ambiguity by using the function <code>local()</code> around your local variables:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">booklet_id =<span class="st"> 'pretest'</span> <span class="co"># local variable</span>
par =<span class="st"> </span><span class="kw">fit_enorm</span>(db, gender<span class="op">==</span><span class="st">'female'</span> <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span>(booklet_id <span class="op">==</span><span class="st"> </span><span class="kw">local</span>(booklet_id) <span class="op">&amp;</span><span class="st"> </span>item_position <span class="op">==</span><span class="st"> </span><span class="dv">3</span>))</code></pre></div>
<p>For consistency, predicates also work when the <code>dataSrc</code> argument is a data.frame.</p>
<p>Because the <code>predicate</code> is passed to the functions that use it independently, one can do strange things like estimate an IRT model from the test responses of females, and use it to score the tests of males.</p>
<p>Another risk with subsetting is that it may destroy the connectedness of the design. The user can check against this with function <code>design_is_connected</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># assuming an item property called `cefr_level` exists in the project</span>
design =<span class="st"> </span><span class="kw">design_as_network</span>(db, booklet_id <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">'bookletA'</span>,<span class="st">'bookletX'</span>,<span class="st">'bookletY'</span>) <span class="op">&amp;</span><span class="st"> </span>cefr_level <span class="op">==</span><span class="st"> 'B1'</span>)
<span class="kw">design_is_connected</span>(design)
## [1] TRUE</code></pre></div>
<p>Even though predicates offer a lot of flexibility, there are some limitations due to the fact that they only work on the individual response level. The typical case that can not be solved by using a predicate, is to omit a whole booklet or person based on some of their responses, but fortunately there is a relatively easy way to get around that limitation.</p>
<p>The following example assumes there are some missing values in your data. Remember, Dexter converts all responses to strings and treats <code>NA</code> responses as the string <code>'NA'</code>. The following line will omit the missing responses (rather than scoring them 0), and calibrate the extended nominal response model. Based on this predicate, only individual missing responses will be omitted, which does not extend to exclusion of whole persons.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">par =<span class="st"> </span><span class="kw">fit_enorm</span>(db, response <span class="op">!=</span><span class="st"> 'NA'</span>)</code></pre></div>
<p>But there might be a valid consideration for wanting to omit all persons who had <em>any</em> missing responses, perhaps administration conditions that caused the missing responses were distracting enough to influence other answers. While this is not possible using just the predicate mechanism, Dexter supports extracting the data, manipulating it and feeding it back to an analysis function manually. The following example will use dplyr to do this in a concise way.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># goal: fit the extended nominal response model using only persons without any missing responses</span>

data =<span class="st"> </span><span class="kw">get_responses</span>(db, <span class="dt">columns=</span><span class="kw">c</span>(<span class="st">'person_id'</span>,<span class="st">'item_id'</span>,<span class="st">'item_score'</span>,<span class="st">'response'</span>)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">group_by</span>(person_id) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">any_missing =</span> <span class="kw">any</span>(response <span class="op">==</span><span class="st"> 'NA'</span>)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">filter</span>(<span class="op">!</span>any_missing)

<span class="co"># the manipulated data can be fed back to the analysis function</span>
par =<span class="st"> </span><span class="kw">fit_enorm</span>(data)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">close_project</span>(db)</code></pre></div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
